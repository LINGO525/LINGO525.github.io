<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­ä¾¿åˆ©åº—çš„æš–å…‰ - æ¶ˆè´¹åå¥½è°ƒç ”</title>
    
 <!-- æ›¿æ¢æˆå…¼å®¹ç‰ˆFirebaseï¼ˆè§£å†³æ¨¡å—è¯­æ³•é”™è¯¯ï¼‰ -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", å®‹ä½“;
        }

        body {
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯å›¾å®¹å™¨ - å ä¸»å¯¼åœ°ä½ */
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('https://picsum.photos/id/292/1920/1080'); /* ã€å¯æ”¹å›¾ç‰‡ã€‘é¡µé¢èƒŒæ™¯å›¾ï¼Œæ›¿æ¢æˆè‡ªå·±çš„æ ¡å›­èƒŒæ™¯å›¾ */
            background-size: cover;
            background-position: center;
            filter: brightness(0.9);
        }

        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 253, 245, 0.7); /* åŠé€æ˜é®ç½©ï¼Œæå‡æ–‡å­—å¯è¯»æ€§ */
            z-index: -1;
        }

        /* ç«‹ç»˜å®¹å™¨æ ·å¼ - ç‹¬ç«‹åˆ†å¼€ï¼Œå±…ä¸­æ˜¾ç¤ºï¼ˆé‡ç‚¹ä¿®æ”¹ï¼‰ */
        .sprite-container {
            position: fixed; /* å›ºå®šä½ç½®ï¼Œä¸éšæ–‡å­—æ¡†æ»šåŠ¨ */
            top: 56%; /* å‚ç›´å±…ä¸­ */
            left: 20%; /* æ°´å¹³å±…ä¸­ */
            transform: translate(-50%, -55%); /* å¾®è°ƒå±…ä¸­ä½ç½®ï¼Œé¿å¼€åº•éƒ¨æ–‡å­—æ¡† */
            z-index: 5; /* å±‚çº§åœ¨èƒŒæ™¯å’Œæ–‡å­—æ¡†ä¹‹é—´ï¼Œä¸é®æŒ¡æ–‡å­— */
            width: 100%;
            max-width: 300px; /* é™åˆ¶å›¾ç‰‡æœ€å¤§å®½åº¦ï¼Œé¿å…è¿‡å¤§ */
            height: auto;
            margin: 0 auto;
            transition: all 0.5s ease;
        }
        
        .sprite-image {
            width: 100%; /* è‡ªé€‚åº”å®¹å™¨å®½åº¦ */
            max-width: 350px; /* æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢å›¾ç‰‡å¤ªå¤§ */
            height: auto; /* é«˜åº¦è‡ªåŠ¨ï¼Œä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.5s ease;
            opacity: 0;
            transform: translateY(20px);
        }
        
        .sprite-image.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* å¯¹è¯æ¡†æ ·å¼ - åº•éƒ¨å‘ˆç°ï¼Œå’Œå›¾ç‰‡å®Œå…¨åˆ†å¼€ */
        .dialog-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            max-width: 100%;
            padding: 20px;
            z-index: 10; /* æ–‡å­—æ¡†å±‚çº§æ¯”å›¾ç‰‡é«˜ï¼Œä¿è¯æ–‡å­—èƒ½çœ‹æ¸… */
        }

        .dialog-box {
            background-color: rgba(255, 252, 245, 0.95);
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            padding: 30px;
            max-height: 40vh; /* ç¼©å°æ–‡å­—æ¡†é«˜åº¦ï¼Œä¸å½±å“å›¾ç‰‡æ˜¾ç¤º */
            overflow-y: auto;
            transform: translateY(0);
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
        }

        /* å¼¹å‡ºåŠ¨ç”» */
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .story-title {
            color: #8b5a2b;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            transition: all 0.4s ease;
        }

        .story-text {
            font-size: 18px;
            margin-bottom: 25px;
            line-height: 1.8;
            color: #444;
            text-align: left;
            padding: 0 5px;
            flex: 1;
            transition: all 0.4s ease;
        }

        /* ä¸‹ä¸€é¡µæŒ‰é’®ï¼ˆå‰§æƒ…é˜¶æ®µï¼‰ */
        .next-btn {
            align-self: center;
            background-color: #8b5a2b;
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 12px 30px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: none;
        }

        .next-btn.active {
            display: block;
            animation: fadeIn 0.5s ease forwards;
        }

        .next-btn:hover {
            background-color: #6d4c2f;
            transform: translateY(-2px);
        }

        /* é—®é¢˜å¼¹å‡ºå®¹å™¨ */
        .question-section {
            background-color: rgba(255, 250, 240, 0.98);
            border-radius: 16px;
            box-shadow: 0 6px 25px rgba(0,0,0,0.18);
            padding: 25px;
            margin-top: 20px;
            display: none;
            flex: 1;
            flex-direction: column;
        }

        .question-section.active {
            display: flex;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .question-text {
            font-size: 17px;
            font-weight: 600;
            color: #6d4c2f;
            margin-bottom: 20px;
            line-height: 1.7;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 10px;
            flex: 1;
            justify-content: center;
        }

        .option-btn {
            background-color: #f8f2e9;
            border: 2px solid #e2b36a;
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 16px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #5a3e2b;
            position: relative;
            overflow: hidden;
        }

        .option-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: all 0.6s ease;
        }

        .option-btn:hover {
            background-color: #f0e6d6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(226, 179, 106, 0.2);
        }

        .option-btn:hover::after {
            left: 100%;
        }

        .option-btn.selected {
            background-color: #e2b36a;
            color: #fff;
            border-color: #8b5a2b;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(139, 90, 43, 0.25);
        }

        /* å¼€å§‹é¡µé¢ - æ–°å¢æ€§åˆ«é€‰æ‹© */
        .gender-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .gender-btn {
            padding: 10px 20px;
            border: 2px solid #e2b36a;
            border-radius: 12px;
            background-color: #f8f2e9;
            color: #5a3e2b;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .gender-btn.selected {
            background-color: #e2b36a;
            color: white;
            border-color: #8b5a2b;
        }

        .start-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 253, 245, 0.92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            z-index: 100;
            animation: fadeInFull 0.8s ease forwards;
        }

        .start-icon {
            font-size: 90px;
            color: #f0c987;
            margin-bottom: 30px;
            animation: bounce 1.5s ease infinite alternate;
            /* ã€å¯æ”¹å›¾ç‰‡ã€‘è¿™é‡Œæ˜¯emojiå›¾æ ‡ï¼Œä¹Ÿå¯ä»¥æ¢æˆå›¾ç‰‡ï¼šæ¯”å¦‚ <img src="è‡ªå·±çš„å›¾æ ‡.png" class="start-icon" /> */
        }

        .start-title {
            color: #8b5a2b;
            font-size: 36px;
            margin-bottom: 20px;
            text-align: center;
        }

        .start-desc {
            font-size: 18px;
            color: #555;
            margin-bottom: 35px;
            text-align: center;
            max-width: 600px;
            line-height: 1.8;
        }

        .consent-section {
            background-color: rgba(248, 242, 233, 0.9);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.08);
            max-height: 50vh;
            overflow-y: auto;
        }

        .consent-title {
            color: #8b5a2b;
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .consent-content {
            color: #555;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .consent-agreement {
            color: #c62828;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .start-btn {
            background-color: #8b5a2b;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .start-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .start-btn:hover:not(:disabled) {
            background-color: #6d4c2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 90, 43, 0.3);
        }

        /* æäº¤é¡µé¢ */
        .submit-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 253, 245, 0.92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            z-index: 100;
            display: none;
            animation: fadeInFull 0.8s ease forwards;
        }

        .submit-icon {
            font-size: 90px;
            color: #f0c987;
            margin-bottom: 30px;
            animation: bounce 1.5s ease infinite alternate;
            /* ã€å¯æ”¹å›¾ç‰‡ã€‘è¿™é‡Œæ˜¯emojiå›¾æ ‡ï¼Œä¹Ÿå¯ä»¥æ¢æˆå›¾ç‰‡ï¼šæ¯”å¦‚ <img src="è‡ªå·±çš„å›¾æ ‡.png" class="submit-icon" /> */
        }

        .submit-title {
            color: #8b5a2b;
            font-size: 36px;
            margin-bottom: 20px;
            text-align: center;
        }

        .submit-desc {
            font-size: 18px;
            color: #555;
            margin-bottom: 35px;
            text-align: center;
            max-width: 600px;
            line-height: 1.8;
        }

        .nickname-input {
            width: 100%;
            max-width: 300px;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #e2b36a;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .nickname-input:focus {
            border-color: #8b5a2b;
            box-shadow: 0 0 10px rgba(139, 90, 43, 0.3);
        }

        .submit-btn {
            background-color: #8b5a2b;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background-color: #6d4c2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 90, 43, 0.3);
        }

        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading-text {
            text-align: center;
            color: #8b5a2b;
            font-size: 18px;
            margin: 20px 0;
        }

        .success-message {
            color: #2e7d32;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .error-message {
            color: #c62828;
            font-size: 16px;
            text-align: center;
            margin: 20px 0;
        }

        /* ç»“æœé¡µé¢ */
        .result-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 253, 245, 0.92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            z-index: 100;
            display: none;
            animation: fadeInFull 0.8s ease forwards;
        }

        @keyframes fadeInFull {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes bounce {
            from {
                transform: translateY(0);
            }
            to {
                transform: translateY(-15px);
            }
        }

        .result-icon {
            font-size: 90px;
            color: #f0c987;
            margin-bottom: 30px;
            animation: bounce 1.5s ease infinite alternate;
            /* ã€å¯æ”¹å›¾ç‰‡ã€‘è¿™é‡Œæ˜¯emojiå›¾æ ‡ï¼Œä¹Ÿå¯ä»¥æ¢æˆå›¾ç‰‡ï¼šæ¯”å¦‚ <img src="è‡ªå·±çš„å›¾æ ‡.png" class="result-icon" /> */
        }

        .result-title {
            color: #8b5a2b;
            font-size: 36px;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-desc {
            font-size: 18px;
            color: #555;
            margin-bottom: 35px;
            text-align: center;
            max-width: 600px;
            line-height: 1.8;
        }

        .preferences-title {
            color: #8b5a2b;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: left;
            width: 100%;
            max-width: 600px;
        }

        .preferences-list {
            text-align: left;
            background-color: rgba(248, 242, 233, 0.9);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.08);
        }

        .preference-item {
            margin-bottom: 18px;
            padding-bottom: 18px;
            border-bottom: 1px dashed #e2b36a;
        }

        .preference-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .preference-question {
            font-weight: bold;
            color: #6d4c2f;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .preference-answer {
            color: #555;
            font-size: 15px;
            line-height: 1.6;
        }

        /* Formspreeè¡¨å•æ ·å¼ï¼ˆå·²ä¿®æ”¹ä¸ºä»…ç”¨äºFirebaseæäº¤ï¼‰ */
        .formspree-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 600px;
        }

        .formspree-input {
            display: none; /* éšè—ï¼Œä½†ä¿ç•™æ•°æ® */
        }

        .footer {
            position: fixed;
            bottom: 20px;
            color: #8b5a2b;
            font-size: 14px;
            text-align: center;
            width: 100%;
            opacity: 0.8;
            z-index: 5;
        }

        /* éšè—å…ƒç´ çš„æ ·å¼ */
        .hidden {
            opacity: 0;
            visibility: hidden;
            height: 0;
            margin: 0;
            padding: 0;
        }

        /* å“åº”å¼è°ƒæ•´ - ä¿è¯æ‰‹æœºä¸Šå›¾ç‰‡å’Œæ–‡å­—æ¡†ä¹Ÿåˆ†å¼€ */
        @media (max-width: 600px) {
            .sprite-container {
                max-width: 200px; /* æ‰‹æœºä¸Šå›¾ç‰‡ç¼©å° */
                top: 45%; /* å¾€ä¸Šç§»ä¸€ç‚¹ï¼Œç»™åº•éƒ¨æ–‡å­—æ¡†ç•™ç©ºé—´ */
            }
            
            .dialog-box {
                padding: 20px 15px;
                max-height: 35vh; /* æ‰‹æœºä¸Šæ–‡å­—æ¡†æ›´çŸ® */
            }

            .story-title {
                font-size: 22px;
            }

            .story-text {
                font-size: 16px;
                margin-bottom: 20px;
            }

            .next-btn {
                padding: 10px 25px;
                font-size: 16px;
                width: 100%;
                max-width: 200px;
            }

            .question-section {
                padding: 20px 15px;
            }

            .question-text {
                font-size: 16px;
            }

            .option-btn {
                padding: 14px 18px;
                font-size: 15px;
            }

            .start-title, .submit-title, .result-title {
                font-size: 28px;
            }

            .start-desc, .submit-desc, .result-desc {
                font-size: 16px;
            }

            .preferences-list {
                padding: 20px;
            }
        }

        /* ç®¡ç†å‘˜å…¥å£æ ·å¼ */
        .admin-entry {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999;
        }
        
        .admin-btn {
            background-color: #6d4c2f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            background-color: #8b5a2b;
            transform: scale(1.1);
        }
        
        /* å¯†ç æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
        }
        
        .modal-title {
            color: #8b5a2b;
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #e2b36a;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .modal-btn {
            background-color: #8b5a2b;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            background-color: #6d4c2f;
        }
        
        .close-btn {
            background-color: #ccc;
            margin-top: 10px;
        }
        
        .close-btn:hover {
            background-color: #999;
        }
        
        /* æ•°æ®æŸ¥çœ‹é¡µé¢æ ·å¼ */
        .data-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f8f2e9;
            z-index: 1001;
            padding: 20px;
            overflow-y: auto;
            display: none;
        }
        
        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2b36a;
        }
        
        .data-title {
            color: #8b5a2b;
            font-size: 26px;
        }
        
        .back-btn {
            background-color: #8b5a2b;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .data-stats {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .stats-title {
            color: #6d4c2f;
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background-color: #f0e6d6;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #8b5a2b;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #5a3e2b;
            font-size: 14px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0e6d6;
        }
        
        .data-table th {
            background-color: #e2b36a;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background-color: #f8f2e9;
        }
        
        .export-btn {
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            background-color: #1b5e20;
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯å›¾å®¹å™¨ -->
    <div class="bg-container"></div>
    <div class="bg-overlay"></div>

    <!-- ç«‹ç»˜å®¹å™¨ - ç‹¬ç«‹åˆ†å¼€ï¼Œä¸å†åœ¨æ–‡å­—æ¡†é‡Œé¢ï¼ˆé‡ç‚¹ä¿®æ”¹ï¼‰ -->
    <div class="sprite-container" id="spriteContainer"></div>

    <!-- å¼€å§‹é¡µé¢ -->
    <div class="start-page" id="startPage">
        <div class="start-icon">ğŸª</div>
        <h2 class="start-title">æ ¡å›­ä¾¿åˆ©åº—çš„æš–å…‰</h2>
        <p class="start-desc">è¿™æ˜¯ä¸€ä»½å…³äºæ ¡å›­ä¾¿åˆ©åº—æ”¹è¿›è®¡åˆ’çš„æ¶ˆè´¹å¿ƒç†å­¦é—®å·ï¼Œé‡‡ç”¨äº’åŠ¨æ•…äº‹å½¢å¼è¿›è¡Œ</p>
        
        <!-- æ–°å¢ï¼šæ€§åˆ«é€‰æ‹© -->
        <div class="gender-selection">
            <button class="gender-btn" data-gender="male">ç”·ç”Ÿ</button>
            <button class="gender-btn" data-gender="female">å¥³ç”Ÿ</button>
        </div>
        
        <div class="consent-section">
            <h3 class="consent-title">çŸ¥æƒ…åŒæ„ä¹¦</h3>
            <div class="consent-content">
                <p>å°Šæ•¬çš„å‚ä¸è€…ï¼š</p>
                <p>æ‚¨å¥½ï¼æˆ‘ä»¬æ­£åœ¨è¿›è¡Œä¸€é¡¹å…³äºæ ¡å›­ä¾¿åˆ©åº—æ”¹è¿›è®¡åˆ’çš„æ¶ˆè´¹å¿ƒç†å­¦ç ”ç©¶ã€‚æœ¬é—®å·æ—¨åœ¨äº†è§£åŒå­¦ä»¬å¯¹æ ¡å›­ä¾¿åˆ©åº—çš„æ¶ˆè´¹åå¥½å’Œæ”¹è¿›å»ºè®®ï¼Œä»¥å¸®åŠ©ä¼˜åŒ–æ ¡å›­å•†ä¸šæœåŠ¡ã€‚</p>
                <p><strong>ç ”ç©¶ç›®çš„ï¼š</strong>æ”¶é›†å­¦ç”Ÿå¯¹æ ¡å›­ä¾¿åˆ©åº—çš„æ¶ˆè´¹åå¥½æ•°æ®ï¼Œç”¨äºå­¦æœ¯ç ”ç©¶å’Œæ ¡å›­å•†ä¸šæœåŠ¡æ”¹è¿›ã€‚</p>
                <p><strong>æ•°æ®ä½¿ç”¨ï¼š</strong>æ‚¨æä¾›çš„æ‰€æœ‰ä¿¡æ¯å°†ä»…ç”¨äºå­¦æœ¯ç ”ç©¶ï¼Œä¸ä¼šç”¨äºä»»ä½•å•†ä¸šç”¨é€”ã€‚æ‚¨çš„ä¸ªäººä¿¡æ¯å°†è¢«ä¸¥æ ¼ä¿å¯†ï¼Œæ•°æ®å°†ä»¥åŒ¿åå½¢å¼å¤„ç†ã€‚</p>
                <p><strong>å‚ä¸åŸåˆ™ï¼š</strong>æ‚¨çš„å‚ä¸å®Œå…¨åŸºäºè‡ªæ„¿åŸåˆ™ï¼Œæ‚¨å¯ä»¥éšæ—¶é€€å‡ºé—®å·è€Œä¸ä¼šå—åˆ°ä»»ä½•ä¸åˆ©å½±å“ã€‚</p>
                <p><strong>æ•°æ®ä¿å­˜ï¼š</strong>æ•°æ®å°†ä¿å­˜åœ¨å®‰å…¨çš„æœåŠ¡å™¨ä¸­ï¼Œç ”ç©¶ç»“æŸåå°†æŒ‰ç›¸å…³è§„å®šè¿›è¡Œå¤„ç†ã€‚</p>
                <p><strong>è”ç³»æ–¹å¼ï¼š</strong>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–æ„è§ï¼Œè¯·è”ç³»ç ”ç©¶å›¢é˜Ÿ13068737710ï¼Œå¹¶è¯´æ˜æ‚¨çš„æ¥æ„ã€‚</p>
            </div>
            <p class="consent-agreement">æˆ‘å·²é˜…è¯»å¹¶ç†è§£ä¸Šè¿°å†…å®¹ï¼ŒåŒæ„å‚ä¸æœ¬æ¬¡è°ƒç ”</p>
        </div>
        
        <button class="start-btn" id="startBtn" disabled>è¯·é€‰æ‹©æ€§åˆ«åå¼€å§‹</button>
    </div>

    <!-- åº•éƒ¨å¯¹è¯æ¡†å®¹å™¨ - åªæ”¾æ–‡å­—å’ŒæŒ‰é’®ï¼Œå’Œå›¾ç‰‡å®Œå…¨åˆ†å¼€ -->
    <div class="dialog-container">
        <div class="dialog-box fade-in" id="storyDialog">
            <h2 class="story-title" id="storyTitle">æ ¡å›­ä¾¿åˆ©åº—çš„æš–å…‰</h2>
            <div class="story-text" id="storyContent">
                <!-- æ•…äº‹å†…å®¹åŠ¨æ€åŠ è½½ -->
            </div>

            <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
            <button class="next-btn" id="nextBtn">ä¸‹ä¸€é¡µ</button>

            <!-- é—®é¢˜åŒºåŸŸ -->
            <div class="question-section" id="questionSection">
                <div class="question-text" id="questionText"></div>
                <div class="options-container" id="optionsContainer">
                    <!-- é€‰é¡¹åŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æäº¤é¡µé¢ -->
    <div class="submit-page" id="submitPage">
        <div class="submit-icon">âœ¨</div>
        <h2 class="submit-title">æ„Ÿè°¢å‚ä¸è°ƒç ”ï¼</h2>
        <p class="submit-desc">ä½ å·²å¸®åŠ©"æš–å…‰ä¾¿åˆ©åº—"å®Œæˆäº†èœ•å˜ï¼Œç°åœ¨è¯·æä¾›æ‚¨çš„æ˜µç§°ä»¥ä¾¿æˆ‘ä»¬è®°å½•æ•°æ®</p>
        
        <input type="text" class="nickname-input" id="nicknameInput" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°ï¼ˆå¯é€‰ï¼‰" maxlength="20">
        
        <!-- ç§»é™¤Formspreeçš„actionï¼Œåªä¿ç•™è¡¨å•ç»“æ„ç”¨äºä¼ é€’æ•°æ® -->
        <form class="formspree-form" id="formspreeForm" method="POST">
            <!-- éšè—è¾“å…¥æ¡†ï¼Œç”¨äºä¼ é€’ç”¨æˆ·é€‰æ‹© -->
            <input type="hidden" name="timestamp" id="timestamp" value="">
            <input type="hidden" name="nickname" id="nicknameHidden" value="">
            <input type="hidden" name="gender" id="genderHidden" value="">
            <input type="hidden" name="ip_address" id="ip_address" value="">
            <input type="hidden" name="user_agent" id="user_agent" value="">
            <input type="hidden" name="answers" id="answers" value="">
            <button type="submit" class="submit-btn" id="submitFormBtn">æäº¤æ•°æ®</button>
        </form>
        
        <div class="loading-text" id="loadingText" style="display: none;">æ­£åœ¨æäº¤æ•°æ®...</div>
        <div class="success-message" id="successMessage" style="display: none;">æ•°æ®æäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼</div>
        <div class="error-message" id="errorMessage" style="display: none;"></div>
    </div>

    <!-- ç»“æœé¡µé¢ -->
    <div class="result-page" id="resultPage">
        <div class="result-icon">âœ¨</div>
        <h2 class="result-title">è°ƒç ”å®Œæˆï¼</h2>
        <p class="result-desc">æ‚¨å·²æˆåŠŸå®Œæˆ"æš–å…‰ä¾¿åˆ©åº—"çš„è°ƒç ”ï¼Œæ„Ÿè°¢æ‚¨çš„å®è´µæ„è§ï¼</p>
        
        <h3 class="preferences-title">ä½ çš„æ¶ˆè´¹åå¥½æ€»ç»“ï¼š</h3>
        <div class="preferences-list" id="preferencesList">
            <!-- åå¥½æ•°æ®åŠ¨æ€åŠ è½½ -->
        </div>
        
        <p class="result-desc">è¿™äº›æ•°æ®å°†ç”¨äºæ ¡å›­ä¾¿åˆ©åº—çš„ä¼˜åŒ–æ”¹è¿›ï¼Œä¸ºå¤§å®¶å¸¦æ¥æ›´å¥½çš„æ¶ˆè´¹ä½“éªŒï¼</p>
    </div>

    <div class="footer">
        æ ¡å›­ä¾¿åˆ©åº—æ”¹è¿›è®¡åˆ’è°ƒç ” &copy; 2025
    </div>

    <!-- Firebaseåˆå§‹åŒ–ï¼ˆæ”¾åœ¨æ‰€æœ‰åŠŸèƒ½è„šæœ¬ä¹‹å‰ï¼Œç¡®ä¿å…¨å±€å¯è®¿é—®ï¼‰ -->
    <script>
        // Firebaseé…ç½®ï¼ˆç”¨ä½ è‡ªå·±çš„é…ç½®ï¼Œå·²å¡«å…¥ä½ æä¾›çš„ä¿¡æ¯ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyBOAagrKu4ZhXZgs4nWZ-ledPiQx5DXpek",
            authDomain: "campus-41e92.firebaseapp.com",
            databaseURL: "https://campus-41e92-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "campus-41e92",
            storageBucket: "campus-41e92.firebasestorage.app",
            messagingSenderId: "128195751728",
            appId: "1:128195751728:web:ac7ec123e9a77dee99e2f5"
        };

        // åˆå§‹åŒ–Firebaseï¼ˆå…¨å±€å˜é‡ï¼Œæ‰€æœ‰è„šæœ¬éƒ½èƒ½ä½¿ç”¨ï¼‰
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <script>
        // ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–ï¼šçµæ´»çš„èŠ‚ç‚¹åŒ–æ•°æ®ç»“æ„
        // æ”¯æŒä»»æ„ç»„åˆï¼šè¿ç»­å‰§æƒ…ã€è¿ç»­é—®é¢˜ã€å‰§æƒ…+é—®é¢˜ç­‰
        // èŠ‚ç‚¹ç±»å‹ï¼šstory(å‰§æƒ…) / question(é—®é¢˜)
        const contentNodes = [
            // ç¤ºä¾‹1ï¼šè¿ç»­ä¸¤æ®µå‰§æƒ… + ä¸¤ä¸ªé—®é¢˜
            {
                type: 'story',
                title: "çªå¦‚å…¶æ¥çš„æ±‚åŠ©",
                text: "å‘¨ä¸‰ä¸‹åˆçš„è‡ªä¹ è¯¾ä¸Šï¼Œä½ çš„æ‰‹æœºæ‚„æ‚„éœ‡åŠ¨èµ·æ¥ã€‚æ˜¯è¡¨å“¥çš„ç”µè¯â€”â€”ä»–æ¥æ‰‹å­¦æ ¡é—¨å£çš„ã€Œæš–å…‰ä¾¿åˆ©åº—ã€æ‰ä¸€ä¸ªæœˆï¼Œç”Ÿæ„ä¸€ç›´ä¸æ¸©ä¸ç«ï¼Œæ€¥å¾—å›¢å›¢è½¬ã€‚",
                sprite: {
                    image: 'https://picsum.photos/id/64/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘å‰§æƒ…1çš„ç«‹ç»˜ï¼ˆæ¯”å¦‚è‡ªå·±çš„è§’è‰²å›¾ç‰‡ï¼‰
                }
            }, 
            {
                type: 'story',
                title: "ç„¦æ€¥çš„å’¨è¯¢",
                text: "ç”µè¯é‡Œä»–è¯­æ°”ç„¦æ€¥ï¼šã€Œå¦¹å¦¹/å¼Ÿå¼Ÿï¼Œä½ åœ¨å­¦æ ¡äººè„‰å¹¿ï¼Œå¸®æˆ‘åˆ†æåˆ†æï¼åŒå­¦ä»¬æ¥ä¾¿åˆ©åº—æœ€åœ¨æ„ä»€ä¹ˆå•Šï¼Ÿå°¤å…¶æ˜¯äº§å“æ–¹é¢ï¼Œæˆ‘æ€»è§‰å¾—å“ªé‡Œæ²¡åšå¥½...ã€",
                sprite: {
                    image: 'https://picsum.photos/id/91/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘è¡¨å“¥çš„ç«‹ç»˜
                }
            },
            {
                type: 'question',
                id: "q1",
                text: "ä½ è®¤ä¸ºä¸‹åˆ—æ ¡å›­ä¾¿åˆ©åº—æœ€ä¼˜çš„è¿›è´§æˆ–äº§å“æ”¹è¿›çš„æ–¹æ¡ˆæ˜¯ï¼Ÿ",
                options: [
                    "A. ä¸ºå¸¦æƒ…æ„Ÿæ ‡ç­¾çš„å•†å“è®¾ç½®åˆç†æº¢ä»·ï¼ˆ5%-15%ï¼‰ï¼Œå¦‚ â€œè€ƒè¯•å­£è§£å‹å’–å•¡â€ï¼ˆåŒ…è£…å° â€œé€¢è€ƒå¿…è¿‡â€ï¼‰ã€â€œå®¿èˆæ²»æ„ˆå°é›¶é£Ÿâ€",
                    "B. é‡‡ç”¨ â€œABC åˆ†ç±»æ³•â€ï¼Œå¯¹çƒ­é”€å“ï¼ˆA ç±»ï¼‰ä¿éšœåº“å­˜ï¼Œç¨³å®šå“ï¼ˆBç±»ï¼‰æ­£å¸¸è¿›è´§ï¼Œæ»é”€å“ï¼ˆC ç±»ï¼‰åŠæ—¶æ¸…ä»“",
                    "C. ä¸æœ¬åœ°ä¾›åº”å•†å»ºç«‹ç¨³å®šåˆä½œï¼Œé’ˆå¯¹ç”Ÿé²œã€æ°´æœç­‰é«˜é¢‘å•†å“ï¼Œé‡‡ç”¨ â€œæ¯æ—¥é…é€ + æŒ‰éœ€é‡‡è´­â€ æ¨¡å¼ ",
                    "D. æ‰¹é‡é‡‡è´­ä¼˜æƒ ï¼šå®¿èˆå›¤è´§è£…ï¼ˆå¦‚çº¸å·¾ï¼‰å®šä»·æ¯”å•ä¹°ä½ 15%-20%ï¼Œæå‡å®¢å•ä»·"
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜ï¼ˆæ¯”å¦‚ä¾¿åˆ©åº—å›¾ç‰‡ï¼‰
                }
            },
            {
                type: 'question',
                id: "q2",
                text: "åœ¨é€‰æ‹©æ ¡å›­ä¾¿åˆ©åº—æ—¶ï¼Œä½ ä¼šé€‰æ‹©ä¸‹åˆ—å“ªç§æ–¹æ¡ˆæ¥è¿›è¡Œå¯¹ä»·æ ¼çš„è°ƒæ§ï¼Ÿ",
                options: [
                    "A. ä¸ºå¸¦æƒ…æ„Ÿæ ‡ç­¾çš„å•†å“è®¾ç½®åˆç†æº¢ä»·ï¼ˆ5%-15%ï¼‰ï¼Œå¦‚ â€œè€ƒè¯•å­£è§£å‹å’–å•¡â€ï¼ˆæ¯”æ™®é€šå’–å•¡è´µ 0.5 å…ƒï¼ŒåŒ…è£…å° â€œé€¢è€ƒå¿…è¿‡â€ï¼‰",
                    "B. ä¼˜åŒ–åº“å­˜ç®¡ç†ï¼šé‡‡ç”¨ â€œABC åˆ†ç±»æ³•â€ï¼Œå¯¹çƒ­é”€å“ï¼ˆA ç±»ï¼‰ä¿éšœåº“å­˜ï¼Œæ»é”€å“ï¼ˆC ç±»ï¼‰åŠæ—¶æ¸…ä»“ï¼Œé¿å…åº“å­˜ç§¯å‹æµªè´¹ï¼Œé™ä½è¿è¥æˆæœ¬",
                    "C. ä¸æœ¬åœ°ä¾›åº”å•†å»ºç«‹ç¨³å®šåˆä½œï¼Œé’ˆå¯¹ç”Ÿé²œã€æ°´æœç­‰é«˜é¢‘å•†å“ï¼Œé‡‡ç”¨ â€œæ¯æ—¥é…é€ + æŒ‰éœ€é‡‡è´­â€ æ¨¡å¼ï¼Œå‡å°‘åº“å­˜ç§¯å‹ï¼Œä¿éšœæ–°é²œåº¦",
                    "D. æ‰¹é‡é‡‡è´­ä¼˜æƒ ï¼šå®¿èˆå›¤è´§è£…ï¼ˆå¦‚ 5 å·è£…åƒåœ¾è¢‹ã€10 åŒ…çº¸å·¾ï¼‰å®šä»·æ¯”å•ä¹°ä½ 15%-20%ï¼Œé¼“åŠ±é›†ä¸­é‡‡è´­ï¼Œæå‡å®¢å•ä»·"
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜
                }
            },
            {
                type: 'question',
                id: "q3",
                text: "åœ¨é€‰æ‹©æ ¡å›­ä¾¿åˆ©åº—æ—¶ï¼Œä½ ä¼šé€‰æ‹©ä¸‹åˆ—å“ªç§æ–¹æ¡ˆæ¥è¿›è¡Œå¯¹ä»·æ ¼çš„è°ƒæ§ï¼Ÿ",
                options: [
                    "A. åŸºç¡€å•†å“ä½ä½å®šä»·ï¼šå¯¹é¥®ç”¨æ°´ã€çº¸å·¾ã€åŸºç¡€æ–‡å…·ç­‰åˆšéœ€å“ï¼Œå®è¡Œ â€œé›¶æº¢ä»·â€ å®šä»·ï¼ˆå¯¹æ ‡æ ¡å¤–è¶…å¸‚æˆ–ç•¥ä½ï¼‰ï¼Œå¸å¼•é«˜é¢‘æ¶ˆè´¹",
                    "B. çº¿ä¸Šçº¿ä¸‹å·®å¼‚åŒ–å®šä»·ï¼šçº¿ä¸Šå°ç¨‹åºè®¾ç½® â€œé¢†åˆ¸å‡ 5 å…ƒâ€â€œæ–°äººé¦–å•ç«‹å‡â€ï¼Œçº¿ä¸‹é—¨åº—æ¨å‡º â€œæ—¶æ®µæŠ˜æ‰£â€ï¼ˆå¦‚æ™š 9 ç‚¹åç”Ÿé²œã€ç†Ÿé£Ÿ 8 æŠ˜ï¼‰",
                    "C. æ¶ˆè´¹ 1 å…ƒç§¯ 1 åˆ†ï¼Œç§¯åˆ†å¯å…‘æ¢ â€œæƒ…ç»ªèˆ’ç¼“å°ç‰©â€ï¼ˆå¦‚è§£å‹ææä¹ã€æš–å¿ƒä¾¿ç­¾æœ¬ï¼‰",
                    "D. é›†ä¸­é‡‡è´­å‹ä»·ï¼šè”åˆå‘¨è¾¹é«˜æ ¡è¶…å¸‚æ‰¹é‡é‡‡è´­é«˜é¢‘å•†å“ï¼Œæå‡è®®ä»·èƒ½åŠ›ï¼Œé™ä½é‡‡è´­æˆæœ¬ï¼Œè§£å†³ â€œè®®ä»·èƒ½åŠ›ä¸è¶³â€ çš„ç—›ç‚¹",
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜
                }
            },
           

            // ç¤ºä¾‹2ï¼šä¸€æ®µå‰§æƒ… + ä¸€ä¸ªé—®é¢˜
            {
                type: 'story',
                title: "ç¬¬ä¸€æ¬¡æ”¹è¿›ï¼šåˆè§æˆæ•ˆ",
                text: "æ ¹æ®ä½ çš„å»ºè®®ï¼Œè¡¨å“¥ç«‹åˆ»è°ƒæ•´äº†è¿›è´§æ¸ é“å’Œè¥é”€æ–¹å¼ï¼ŒåŠ å¼ºäº†äº§å“ç®¡ç†ã€‚ä¸€å‘¨åï¼Œä»–å…´å¥‹åœ°å‘Šè¯‰ä½ ï¼šã€Œå¤ªç®¡ç”¨äº†ï¼è¥ä¸šé¢ç›´æ¥æ¶¨äº†200å…ƒï¼ä¸è¿‡æˆ‘å‘ç°åŒå­¦ä»¬ç»“è´¦æ—¶å¶å°”ä¼šæŠ±æ€¨...ä½ è§‰å¾—æœåŠ¡å’Œç¯å¢ƒæ–¹é¢ï¼Œæˆ‘ä»¬è¿˜èƒ½æ€ä¹ˆä¼˜åŒ–ï¼Ÿã€",
                sprite: {
                    image: 'https://picsum.photos/id/177/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘è¡¨å“¥å¼€å¿ƒçš„ç«‹ç»˜
                }
            },
            {
                type: 'question',
                id: "q4",
                text: "ä½ æœ€å¸Œæœ›æ ¡å›­ä¾¿åˆ©åº—åœ¨æœåŠ¡/ç¯å¢ƒæ–¹é¢æ”¹è¿›å“ªä¸€ç‚¹ï¼Ÿ",
                options: [
                    "A. è®¾ç½® â€œè§£å‹è§’è½â€ï¼ˆ2-3 ç»„è½¯åº§æ¤… + å°æ¡Œæ¿ï¼‰ï¼Œé…å¤‡å…è´¹å……ç”µå£ã€èˆ’ç¼“èƒŒæ™¯éŸ³ä¹ï¼Œæä¾›å…è´¹é¥®ç”¨æ°´å’Œçº¸å·¾",
                    "B. è®¾ç«‹ â€œç‰¹æ®Šéœ€æ±‚è§’â€ï¼Œå¼•å…¥ç´ é£Ÿé›¶é£Ÿã€æ— ä¹³ç³–ç‰›å¥¶ã€è¿‡æ•å‹å¥½å‹æŠ¤è‚¤å“ï¼Œè´´ â€œç²¾å‡†é€‚é…â€ æ ‡ç­¾ï¼Œè§£å†³å•†å“åŒè´¨åŒ–é—®é¢˜",
                    "C. æ—©é«˜å³°è®¾ â€œèµ¶è¯¾å¿«é€Ÿé€šé“â€ï¼ˆè‡ªåŠ©æ”¶é“¶ + é¢„åŒ…è£…æ—©é¤ä¸“åŒºï¼‰ï¼Œæ™šé«˜å³°å¼€è¾Ÿ â€œå¤œå®µæ”¾æ¾åŒºâ€ï¼ˆå…³ä¸œç…®ã€çƒ­é¥®é™ˆåˆ— + æš–å…‰ç…§æ˜ï¼‰ï¼Œç”¨ç¯å¢ƒæ°›å›´è°ƒåŠ¨ç§¯ææƒ…ç»ª",
                    "D. æ–°å¢ 2-3 å°è‡ªåŠ©æ”¶é“¶æœºï¼Œæ—©ã€æ™šç‰¹å®šæ—¶æ®µå¼€é€š â€œå¿«é€Ÿé€šé“â€ï¼Œå‡å°‘æ’é˜Ÿæ—¶é—´ï¼Œ"
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜
                }
            },

            // ç¤ºä¾‹3ï¼šè¿ç»­ä¸¤ä¸ªé—®é¢˜ + ä¸€æ®µå‰§æƒ…
            {
                type: 'question',
                id: "q5",
                text: "ä½ ä¸‹åˆ—æœ€æ„Ÿå…´è¶£çš„æ ¡å›­ä¾¿åˆ©åº—ä¿ƒé”€æ–¹å¼æ˜¯ï¼Ÿ",
                options: [
                    "A. èŠ‚ç‚¹ä¿ƒé”€ï¼šå¼€å­¦å­£ â€œæ–°ç”Ÿæ»¡å‡â€ï¼ˆæ»¡10å‡3ï¼‰ã€è€ƒè¯•å­£ â€œè¡¥ç»™ä¹°èµ â€ï¼ˆå’–å•¡ä¹°2é€1ï¼‰ã€æ¯•ä¸šå­£ â€œçºªå¿µå•†å“æŠ˜æ‰£â€",
                    "B. ",
                    "C. å‡çº§å¾®ä¿¡å°ç¨‹åºï¼šæ–°å¢ â€œå•†å“å¯¼èˆªâ€â€œåº“å­˜æŸ¥è¯¢â€â€œé¢„çº¦é¢„ç•™â€ åŠŸèƒ½ï¼Œå¢åŠ é…é€æœåŠ¡ï¼ˆæ»¡10å…ƒå…é…é€ï¼‰",
                    "D. æ ¡å›­å›¢é•¿åˆ†é”€ï¼šæ‹›å‹Ÿå­¦ç”Ÿæ‹…ä»» â€œå®¿èˆå›¢é•¿â€ï¼Œè´Ÿè´£æ”¶é›†æœ¬å®¿èˆ / ç­çº§éœ€æ±‚ï¼Œæ‰¹é‡ä¸‹å•äº«é¢å¤–æŠ˜æ‰£ï¼ˆå›¢é•¿è·å°é¢ææˆï¼‰"
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜
                }
            },
            {
                type: 'story',
                title: "å£ç¢‘å‘é…µ",
                text: "è°ƒæ•´ä¿ƒé”€ç­–ç•¥å’Œä¼šå‘˜ä½“ç³»åï¼Œä¾¿åˆ©åº—çš„ç›ˆåˆ©ç»ˆäºåŒæ­¥å¢é•¿ï¼Œè¥ä¸šé¢å†æ¶¨1500å…ƒï¼è¶Šæ¥è¶Šå¤šåŒå­¦æ„¿æ„æ¥ã€Œæš–å…‰ã€æ¶ˆè´¹ï¼Œè¡¨å“¥çš„ä¿¡å¿ƒå¤§å¢ã€‚",
                sprite: {
                    image: 'https://picsum.photos/id/177/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘è¡¨å“¥è‡ªä¿¡çš„ç«‹ç»˜
                }
            },

            // ç¤ºä¾‹4ï¼šä¸€æ®µå‰§æƒ… + ä¸€ä¸ªé—®é¢˜
            {
                type: 'story',
                title: "ç¬¬å››æ¬¡æ”¹è¿›ï¼šå…¨é¢å‡çº§",
                text: "ä¼šå‘˜ä½“ç³»ä¸Šçº¿åï¼Œã€Œæš–å…‰ä¾¿åˆ©åº—ã€çš„å¿ å®é¡¾å®¢è¶Šæ¥è¶Šå¤šï¼Œè¥ä¸šé¢ç›´æ¥æš´æ¶¨3000å…ƒï¼è¡¨å“¥æƒ³è¿›è¡Œä¸€æ¬¡å…¨é¢çš„ç¯å¢ƒè®¾æ–½å‡çº§ã€‚ä»–ç‰¹æ„æ¥é—®ä½ ï¼šã€Œç°åœ¨åº—é‡Œçš„è®¾æ–½è¿˜æœ‰å“ªäº›ä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼Ÿæ¯”å¦‚åº§ä½ã€å……ç”µè¿™äº›ï¼ŒåŒå­¦ä»¬æœ‰æ²¡æœ‰éœ€æ±‚ï¼Ÿã€",
                sprite: {
                    image: 'https://picsum.photos/id/177/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘è¡¨å“¥å…´å¥‹çš„ç«‹ç»˜
                }
            },
            {
                type: 'question',
                id: "q7",
                text: "ä½ å¸Œæœ›æ ¡å›­ä¾¿åˆ©åº—å¢åŠ /æ”¹è¿›å“ªäº›ç¯å¢ƒè®¾æ–½ï¼Ÿ",
                options: [
                    "A. è§£å‹äº’åŠ¨åŒºï¼šæ”¾ç½® â€œææä¹å…±äº«ç›’â€â€œæ¶‚é¸¦è§£å‹æ¿â€ï¼Œå­¦ç”Ÿæ¶ˆè´¹æ»¡ 10 å…ƒè·å¾— â€œè§£å‹æ¸¸æˆä½“éªŒåˆ¸â€ï¼ˆå¦‚ç›²ç›’æŠ½å¥–ï¼‰",
                    "B. å¢è®¾æ‰‹æœºå……ç”µæ¥å£",
                    "C. å¢åŠ å¾®æ³¢ç‚‰ï¼ˆæ–¹ä¾¿åŠ çƒ­é¤é£Ÿï¼‰",
                    "D. ä¼˜åŒ–è´§æ¶å¸ƒå±€ï¼Œæ‰¾å•†å“æ›´æ–¹ä¾¿"
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜
                }
            },

            // ç¤ºä¾‹5ï¼šè¿ç»­ä¸¤æ®µå‰§æƒ… + ä¸€ä¸ªé—®é¢˜
            {
                type: 'story',
                title: "ç¬¬äº”æ¬¡æ”¹è¿›ï¼šè£èª‰åŠ èº«",
                text: "è®¾æ–½å‡çº§åï¼Œã€Œæš–å…‰ä¾¿åˆ©åº—ã€æˆäº†æ ¡å›­é‡Œçš„çƒ­é—¨æ‰“å¡ç‚¹ï¼Œè¥ä¸šé¢å†æ¶¨2000å…ƒï¼å‡­å€Ÿä¼˜è´¨çš„äº§å“ã€æœåŠ¡å’Œç¯å¢ƒï¼Œä¾¿åˆ©åº—è¿˜è·å¾—äº†å­¦æ ¡é¢å‘çš„ã€Œå­£åº¦ä¼˜è´¨å•†æˆ·ã€ç§°å·ã€‚",
                sprite: {
                    image: 'https://picsum.photos/id/177/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘è¡¨å“¥è·å¥–çš„ç«‹ç»˜
                }
            },
            {
                type: 'story',
                title: "æ‰©å¤§å½±å“åŠ›",
                text: "è¡¨å“¥æƒ³è¶åŠ¿æ‰©å¤§å½±å“åŠ›ï¼šã€Œæˆ‘ä»¬æƒ³å’ŒåŒå­¦ä»¬æœ‰æ›´å¤šäº’åŠ¨ï¼Œè®©å¤§å®¶æ›´æœ‰å½’å±æ„Ÿï¼Œä½ è§‰å¾—å“ªç§å“ç‰Œäº’åŠ¨æ–¹å¼æœ€å¸å¼•äººï¼Ÿã€",
                sprite: {
                    image: 'https://picsum.photos/id/91/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘è¡¨å“¥å’¨è¯¢çš„ç«‹ç»˜
                }
            },
            {
                type: 'question',
                id: "q8",
                text: "ä½ æœ€æ„Ÿå…´è¶£çš„æ ¡å›­ä¾¿åˆ©åº—å“ç‰Œäº’åŠ¨æ–¹å¼æ˜¯ï¼Ÿ",
                options: [
                    "A. æ ¡å›­ä¸»é¢˜æ´»åŠ¨ï¼ˆå¦‚è€ƒè¯•å­£åŠ æ²¹ç¤¼åŒ…ï¼‰",
                    "B. æ–°å“è¯•åƒæ´»åŠ¨",
                    "C. æ¶ˆè´¹æ»¡é¢æŠ½å¥–ï¼ˆå¥–å“ä¸ºæ ¡å›­å‘¨è¾¹ï¼‰",
                    "D. çº¿ä¸ŠæŠ•ç¥¨é€‰æ–°å“ï¼ˆç”±åŒå­¦ä»¬å†³å®šè¿›è´§å“ç±»ï¼‰"
                ],
                sprite: {
                    image: 'https://picsum.photos/id/237/400/600' // ã€å¯æ”¹å›¾ç‰‡ã€‘é—®é¢˜é˜¶æ®µçš„ç«‹ç»˜
                }
            }
        ];

        // å…¨å±€å˜é‡
        let currentNodeIndex = 0; // å½“å‰èŠ‚ç‚¹ç´¢å¼•
        const userAnswers = {}; // å­˜å‚¨ç”¨æˆ·é€‰æ‹©çš„ç­”æ¡ˆ
        let userNickname = ''; // å­˜å‚¨ç”¨æˆ·æ˜µç§°
        let userGender = ''; // å­˜å‚¨ç”¨æˆ·æ€§åˆ«
        
        // æ€§åˆ«ç›¸å…³ç«‹ç»˜ - ã€å¯æ”¹å›¾ç‰‡ã€‘æ›¿æ¢æˆè‡ªå·±çš„ç”·ç”Ÿ/å¥³ç”Ÿç«‹ç»˜
        const genderSprites = {
            male: 'https://picsum.photos/id/1012/400/600', // ç”·ç”Ÿç«‹ç»˜
            female: 'https://picsum.photos/id/1027/400/600' // å¥³ç”Ÿç«‹ç»˜
        };

        // DOMå…ƒç´ 
        const startPage = document.getElementById('startPage');
        const startBtn = document.getElementById('startBtn');
        const genderBtns = document.querySelectorAll('.gender-btn');
        const storyDialog = document.getElementById('storyDialog');
        const storyTitle = document.getElementById('storyTitle');
        const storyContent = document.getElementById('storyContent');
        const nextBtn = document.getElementById('nextBtn');
        const questionSection = document.getElementById('questionSection');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const submitPage = document.getElementById('submitPage');
        const nicknameInput = document.getElementById('nicknameInput');
        const formspreeForm = document.getElementById('formspreeForm');
        const submitFormBtn = document.getElementById('submitFormBtn');
        const loadingText = document.getElementById('loadingText');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const timestampInput = document.getElementById('timestamp');
        const nicknameHidden = document.getElementById('nicknameHidden');
        const genderHidden = document.getElementById('genderHidden');
        const ipAddressInput = document.getElementById('ip_address');
        const userAgentInput = document.getElementById('user_agent');
        const answersInput = document.getElementById('answers');
        const resultPage = document.getElementById('resultPage');
        const preferencesList = document.getElementById('preferencesList');
        const spriteContainer = document.getElementById('spriteContainer');

        // ç»‘å®šæ€§åˆ«é€‰æ‹©äº‹ä»¶
        genderBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                genderBtns.forEach(b => b.classList.remove('selected'));
                // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
                btn.classList.add('selected');
                // ä¿å­˜æ€§åˆ«
                userGender = btn.getAttribute('data-gender');
                // å¯ç”¨å¼€å§‹æŒ‰é’®
                startBtn.disabled = false;
                startBtn.textContent = 'åŒæ„å¹¶å¼€å§‹æ¸¸æˆ';
            });
        });

        // ç»‘å®šå¼€å§‹æŒ‰é’®äº‹ä»¶
        startBtn.addEventListener('click', () => {
            startPage.style.display = 'none';
            storyDialog.style.display = 'flex';
            initCurrentNode();
        });

        // ç»‘å®šä¸‹ä¸€é¡µæŒ‰é’®äº‹ä»¶ï¼ˆå‰§æƒ…èŠ‚ç‚¹ä¸“ç”¨ï¼‰
        nextBtn.addEventListener('click', () => {
            nextBtn.classList.remove('active');
            showNextNode(); // è¿›å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        });

        /**
         * åˆå§‹åŒ–å½“å‰èŠ‚ç‚¹ï¼šæ ¹æ®èŠ‚ç‚¹ç±»å‹æ¸²æŸ“å‰§æƒ…æˆ–é—®é¢˜
         */
        function initCurrentNode() {
            // æ‰€æœ‰èŠ‚ç‚¹å¤„ç†å®Œæ¯•ï¼Œæ˜¾ç¤ºæäº¤é¡µé¢
            if (currentNodeIndex >= contentNodes.length) {
                showSubmitPage();
                return;
            }

            const currentNode = contentNodes[currentNodeIndex];

            // éšè—æ‰€æœ‰æ¨¡å—ï¼Œå‡†å¤‡æ¸²æŸ“å½“å‰èŠ‚ç‚¹
            resetAllModules();

            // æ¸²æŸ“ç«‹ç»˜
            renderSprite(currentNode);

            // æ ¹æ®èŠ‚ç‚¹ç±»å‹æ¸²æŸ“
            if (currentNode.type === 'story') {
                // æ¸²æŸ“å‰§æƒ…èŠ‚ç‚¹
                renderStoryNode(currentNode);
            } else if (currentNode.type === 'question') {
                // æ¸²æŸ“é—®é¢˜èŠ‚ç‚¹
                renderQuestionNode(currentNode);
            }
        }

        /**
         * æ¸²æŸ“ç«‹ç»˜
         * @param {Object} node - å½“å‰èŠ‚ç‚¹æ•°æ®
         */
        function renderSprite(node) {
            if (!node.sprite) {
                spriteContainer.innerHTML = '';
                return;
            }
            
            // åˆ›å»ºç«‹ç»˜å…ƒç´ 
            const spriteImg = document.createElement('img');
            spriteImg.className = 'sprite-image';
            spriteImg.src = node.sprite.image;
            
            // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ æ–°å›¾ç‰‡
            spriteContainer.innerHTML = '';
            spriteContainer.appendChild(spriteImg);
            
            // è§¦å‘åŠ¨ç”»
            setTimeout(() => {
                spriteImg.classList.add('visible');
            }, 100);
        }

        /**
         * æ¸²æŸ“å‰§æƒ…èŠ‚ç‚¹
         * @param {Object} storyNode - å‰§æƒ…èŠ‚ç‚¹æ•°æ®
         */
        function renderStoryNode(storyNode) {
            storyTitle.textContent = storyNode.title;
            storyContent.textContent = storyNode.text;
            
            // æ˜¾ç¤ºä¸‹ä¸€é¡µæŒ‰é’®ï¼ˆå»¶è¿Ÿæ˜¾ç¤ºï¼Œå¢åŠ é˜…è¯»ä½“éªŒï¼‰
            setTimeout(() => {
                nextBtn.classList.add('active');
            }, 800);
        }

        /**
         * æ¸²æŸ“é—®é¢˜èŠ‚ç‚¹
         * @param {Object} questionNode - é—®é¢˜èŠ‚ç‚¹æ•°æ®
         */
        function renderQuestionNode(questionNode) {
            storyTitle.textContent = "ä½ çš„é€‰æ‹©";
            storyContent.textContent = "è¯·æ ¹æ®ä½ çš„çœŸå®æƒ³æ³•é€‰æ‹©ï¼š";
            
            // è®¾ç½®é—®é¢˜å†…å®¹
            questionText.textContent = questionNode.text;
            
            // æ¸…ç©ºå¹¶åˆ›å»ºé€‰é¡¹æŒ‰é’®
            optionsContainer.innerHTML = '';
            questionNode.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option;
                optionBtn.setAttribute('data-index', index);
                
                // é€‰é¡¹ç‚¹å‡»äº‹ä»¶
                optionBtn.addEventListener('click', () => {
                    // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    
                    // æ·»åŠ å½“å‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                    optionBtn.classList.add('selected');
                    
                    // ä¿å­˜ç­”æ¡ˆ
                    userAnswers[questionNode.id] = {
                        question: questionNode.text,
                        answer: option,
                        timestamp: new Date().toISOString()
                    };
                    
                    // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¢åŠ äº¤äº’ä½“éªŒ
                    setTimeout(() => {
                        showNextNode();
                    }, 500);
                });
                
                optionsContainer.appendChild(optionBtn);
            });
            
            // æ˜¾ç¤ºé—®é¢˜åŒºåŸŸ
            questionSection.classList.add('active');
        }

        /**
         * é‡ç½®æ‰€æœ‰æ¨¡å—çš„æ˜¾ç¤ºçŠ¶æ€
         */
        function resetAllModules() {
            nextBtn.classList.remove('active');
            questionSection.classList.remove('active');
            optionsContainer.innerHTML = '';
        }

        /**
         * æ˜¾ç¤ºä¸‹ä¸€ä¸ªèŠ‚ç‚¹
         */
        function showNextNode() {
            currentNodeIndex++;
            initCurrentNode();
        }

        /**
         * æ˜¾ç¤ºæäº¤é¡µé¢
         */
        function showSubmitPage() {
            storyDialog.style.display = 'none';
            submitPage.style.display = 'flex';
            
            // å‰ç«¯æ— æ³•è·å–çœŸå®IPï¼Œæ”¹ä¸ºæ˜¾ç¤º"æœªçŸ¥"
            ipAddressInput.value = 'æœªçŸ¥ï¼ˆå‰ç«¯æ— æ³•è·å–çœŸå®IPï¼‰';
            // è·å–å¹¶è®¾ç½®ç”¨æˆ·ä»£ç†
            userAgentInput.value = navigator.userAgent;
            // è®¾ç½®æ—¶é—´æˆ³
            timestampInput.value = new Date().toISOString();
            // è®¾ç½®æ€§åˆ«
            genderHidden.value = userGender;

            // ç›‘å¬æ˜µç§°è¾“å…¥
            nicknameInput.addEventListener('input', () => {
                userNickname = nicknameInput.value.trim();
                nicknameHidden.value = userNickname || 'åŒ¿åç”¨æˆ·';
            });
        }

        /**
         * æ˜¾ç¤ºç»“æœé¡µé¢
         */
        function showResultPage() {
            submitPage.style.display = 'none';
            resultPage.style.display = 'flex';
            
            // æ¸²æŸ“åå¥½åˆ—è¡¨
            preferencesList.innerHTML = '';
            Object.values(userAnswers).forEach(item => {
                const preferenceItem = document.createElement('div');
                preferenceItem.className = 'preference-item';
                
                const question = document.createElement('div');
                question.className = 'preference-question';
                question.textContent = item.question;
                
                const answer = document.createElement('div');
                answer.className = 'preference-answer';
                answer.textContent = `ä½ çš„é€‰æ‹©ï¼š${item.answer}`;
                
                preferenceItem.appendChild(question);
                preferenceItem.appendChild(answer);
                preferencesList.appendChild(preferenceItem);
            });
        }
    </script>

    <!-- Firebaseè¡¨å•æäº¤é€»è¾‘ï¼ˆæ›¿æ¢åŸFormspreeæäº¤ï¼‰ -->
    <script>
        // ç»™è¡¨å•ç»‘å®šæäº¤äº‹ä»¶ï¼ˆä»…Firebaseæäº¤ï¼Œæ— åŒé‡æäº¤ï¼‰
        document.getElementById('formspreeForm').addEventListener('submit', function(e) {
            e.preventDefault();          
            document.getElementById('submitFormBtn').disabled = true;    
            document.getElementById('loadingText').style.display = 'block';    
            document.getElementById('errorMessage').style.display = 'none';           
            
            // æ”¶é›†è¡¨å•æ•°æ®
            const formData = {      
                timestamp: new Date().toISOString(),      
                nickname: document.getElementById('nicknameHidden').value,      
                gender: document.getElementById('genderHidden').value,      
                ip_address: document.getElementById('ip_address').value,      
                user_agent: document.getElementById('user_agent').value,      
                answers: document.getElementById('answers').value    
            };            
            
            // ä¿å­˜æ•°æ®åˆ°Firebase
            database.ref('responses').push(formData)
                .then(() => {              
                    document.getElementById('loadingText').style.display = 'none';        
                    document.getElementById('successMessage').style.display = 'block';                       
                    setTimeout(() => {          
                        showResultPage();        
                    }, 2000);      
                })
                .catch((error) => {               
                    document.getElementById('loadingText').style.display = 'none';        
                    document.getElementById('errorMessage').textContent = "æäº¤å¤±è´¥: " + error.message;        
                    document.getElementById('errorMessage').style.display = 'block';        
                    document.getElementById('submitFormBtn').disabled = false;      
                });  
        });
    </script>

    <!-- ç®¡ç†å‘˜å…¥å£åŠæ•°æ®æŸ¥çœ‹åŠŸèƒ½ -->
    <div class="admin-entry">
        <button class="admin-btn" id="adminBtn">ç®¡</button>
    </div>

    <!-- å¯†ç éªŒè¯æ¨¡æ€æ¡† -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <h3 class="modal-title">ç®¡ç†å‘˜éªŒè¯</h3>
            <input type="password" class="password-input" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <button class="modal-btn" id="verifyBtn">éªŒè¯</button>
            <button class="modal-btn close-btn" id="closeModal">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- æ•°æ®æŸ¥çœ‹é¡µé¢ -->
    <div class="data-view" id="dataView">
        <div class="data-header">
            <h2 class="data-title">è°ƒç ”æ•°æ®ç®¡ç†</h2>
            <button class="back-btn" id="backBtn">è¿”å›é—®å·</button>
        </div>
        
        <div class="data-stats">
            <h3 class="stats-title">æ•°æ®ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalResponses">0</div>
                    <div class="stat-label">æ€»å‚ä¸äººæ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="maleResponses">0</div>
                    <div class="stat-label">ç”·ç”Ÿæ¯”ä¾‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="femaleResponses">0</div>
                    <div class="stat-label">å¥³ç”Ÿæ¯”ä¾‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completionRate">0%</div>
                    <div class="stat-label">å®Œæˆç‡</div>
                </div>
            </div>
        </div>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>åºå·</th>
                    <th>æ—¶é—´</th>
                    <th>æ˜µç§°</th>
                    <th>æ€§åˆ«</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="dataTableBody">
                <!-- æ•°æ®å°†åŠ¨æ€åŠ è½½ -->
            </tbody>
        </table>
        
        <button class="export-btn" id="exportBtn">å¯¼å‡ºæ•°æ®ä¸ºCSV</button>
    </div>

    <script>
        // ç®¡ç†å‘˜åŠŸèƒ½ç›¸å…³å˜é‡
        const ADMIN_PASSWORD = "1145141919810"; // è¯·åŠ¡å¿…ä¿®æ”¹ä¸ºå®‰å…¨çš„å¯†ç ï¼ˆå»ºè®®æ”¹æˆå¤æ‚å¯†ç ï¼‰
        let surveyData = []; // å­˜å‚¨æ‰€æœ‰è°ƒç ”æ•°æ®
        
        // DOMå…ƒç´ 
        const adminBtn = document.getElementById('adminBtn');
        const passwordModal = document.getElementById('passwordModal');
        const adminPassword = document.getElementById('adminPassword');
        const verifyBtn = document.getElementById('verifyBtn');
        const closeModal = document.getElementById('closeModal');
        const dataView = document.getElementById('dataView');
        const backBtn = document.getElementById('backBtn');
        const totalResponses = document.getElementById('totalResponses');
        const maleResponses = document.getElementById('maleResponses');
        const femaleResponses = document.getElementById('femaleResponses');
        const completionRate = document.getElementById('completionRate');
        const dataTableBody = document.getElementById('dataTableBody');
        const exportBtn = document.getElementById('exportBtn');
        
        // ç»‘å®šç®¡ç†å‘˜æŒ‰é’®äº‹ä»¶
        adminBtn.addEventListener('click', () => {
            passwordModal.style.display = 'flex';
            adminPassword.value = '';
            adminPassword.focus();
        });
        
        // ç»‘å®šå…³é—­æ¨¡æ€æ¡†äº‹ä»¶
        closeModal.addEventListener('click', () => {
            passwordModal.style.display = 'none';
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', (e) => {
            if (e.target === passwordModal) {
                passwordModal.style.display = 'none';
            }
        });
        

    verifyBtn.addEventListener('click', () => {
      const inputPwd = adminPassword.value.trim(); // å»æ‰å¯†ç å‰åç©ºæ ¼
      if (inputPwd === ADMIN_PASSWORD) {
        // æ­£ç¡®é€»è¾‘ï¼šå…³é—­å¯†ç æ¨¡æ€æ¡† â†’ æ˜¾ç¤ºæ•°æ®é¡µé¢ â†’ åŠ è½½æ•°æ®
        passwordModal.style.display = 'none'; // éšè—å¯†ç æ¡†
        dataView.style.display = 'block'; // æ˜¾ç¤ºç®¡ç†å‘˜æ•°æ®é¡µé¢ï¼ˆå…³é”®ï¼šä¸è¦å†™startPageï¼ï¼‰
        loadSurveyData(); // åŠ è½½è°ƒç ”æ•°æ®
      } else {
        alert('å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•');
        adminPassword.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
        adminPassword.focus(); // è®©å…‰æ ‡å›åˆ°è¾“å…¥æ¡†
      }
    });
        
        // ç»‘å®šè¿”å›æŒ‰é’®äº‹ä»¶
        backBtn.addEventListener('click', () => {
            dataView.style.display = 'none';
        });
        
        // åŠ è½½è°ƒç ”æ•°æ®ï¼ˆä»Firebaseï¼‰
        function loadSurveyData() {
            // ä»FirebaseåŠ è½½æ•°æ®
            database.ref('responses').once('value')
              .then((snapshot) => {
                const data = snapshot.val();
                surveyData = data ? Object.values(data) : [];
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStatistics();
                
                // æ›´æ–°æ•°æ®è¡¨æ ¼
                updateDataView();
              })
              .catch((error) => {
                console.error("åŠ è½½æ•°æ®å¤±è´¥: ", error);
                alert("åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•");
              });
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            const total = surveyData.length;
            totalResponses.textContent = total;
            
            if (total === 0) {
                maleResponses.textContent = "0 (0%)";
                femaleResponses.textContent = "0 (0%)";
                completionRate.textContent = "0%";
                return;
            }
            
            // è®¡ç®—æ€§åˆ«æ¯”ä¾‹
            const maleCount = surveyData.filter(item => item.gender === 'male').length;
            const femaleCount = total - maleCount;
            const malePercent = Math.round((maleCount / total) * 100);
            const femalePercent = 100 - malePercent;
            
            maleResponses.textContent = `${maleCount} (${malePercent}%)`;
            femaleResponses.textContent = `${femaleCount} (${femalePercent}%)`;
            
            // è®¡ç®—å®Œæˆç‡ï¼ˆè¿™é‡Œå‡è®¾æ‰€æœ‰æ•°æ®éƒ½æ˜¯å®Œæˆçš„ï¼‰
            completionRate.textContent = "100%";
        }
        
        // æ›´æ–°æ•°æ®è¡¨æ ¼
        function updateDataView() {
            dataTableBody.innerHTML = '';
            
            if (surveyData.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = '<td colspan="5" style="text-align: center; padding: 20px;">æš‚æ— æ•°æ®</td>';
                dataTableBody.appendChild(emptyRow);
                return;
            }
            
            // å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            surveyData.slice().reverse().forEach((item, index) => {
                const row = document.createElement('tr');
                const date = new Date(item.timestamp).toLocaleString();
                
                row.innerHTML = `
                    <td>${surveyData.length - index}</td>
                    <td>${date}</td>
                    <td>${item.nickname || 'åŒ¿åç”¨æˆ·'}</td>
                    <td>${item.gender === 'male' ? 'ç”·ç”Ÿ' : 'å¥³ç”Ÿ'}</td>
                    <td>
                        <button class="view-details-btn" data-index="${surveyData.length - 1 - index}">æŸ¥çœ‹è¯¦æƒ…</button>
                    </td>
                `;
                
                dataTableBody.appendChild(row);
            });
            
            // ç»‘å®šæŸ¥çœ‹è¯¦æƒ…æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    showDetails(index);
                });
            });
        }
        
        // æ˜¾ç¤ºè¯¦æƒ…
        function showDetails(index) {
            const item = surveyData[index];
            let details = `
                <strong>æ—¶é—´ï¼š</strong>${new Date(item.timestamp).toLocaleString()}<br>
                <strong>æ˜µç§°ï¼š</strong>${item.nickname || 'åŒ¿åç”¨æˆ·'}<br>
                <strong>æ€§åˆ«ï¼š</strong>${item.gender === 'male' ? 'ç”·ç”Ÿ' : 'å¥³ç”Ÿ'}<br>
                <strong>IPåœ°å€ï¼š</strong>${item.ip_address}<br>
                <br><strong>å›ç­”è¯¦æƒ…ï¼š</strong><br>
            `;
            
            try {
                const answers = JSON.parse(item.answers);
                Object.values(answers).forEach(ans => {
                    details += `- ${ans.question}<br>  ${ans.answer}<br><br>`;
                });
            } catch (e) {
                details += item.answers;
            }
            
            alert(details);
        }
        
        // å¯¼å‡ºæ•°æ®ä¸ºCSV
        exportBtn.addEventListener('click', () => {
            if (surveyData.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            // æ„å»ºCSVå†…å®¹
            let csvContent = "åºå·,æ—¶é—´,æ˜µç§°,æ€§åˆ«,IPåœ°å€,å›ç­”è¯¦æƒ…\n";
            
            surveyData.forEach((item, index) => {
                const date = new Date(item.timestamp).toLocaleString();
                const nickname = item.nickname || 'åŒ¿åç”¨æˆ·';
                const gender = item.gender === 'male' ? 'ç”·ç”Ÿ' : 'å¥³ç”Ÿ';
                const ip = item.ip_address;
                
                // å¤„ç†answersä¸­çš„å¼•å·å’Œé€—å·
                let answers = '';
                try {
                    const ansObj = JSON.parse(item.answers);
                    answers = Object.values(ansObj).map(ans => {
                        return `"${ans.question}":"${ans.answer}"`;
                    }).join('; ');
                } catch (e) {
                    answers = item.answers;
                }
                
                // æ›¿æ¢åŒå¼•å·ä¸ºä¸¤ä¸ªåŒå¼•å·ï¼ˆCSVè½¬ä¹‰ï¼‰
                answers = answers.replace(/"/g, '""');
                
                csvContent += `${index + 1},"${date}","${nickname}","${gender}","${ip}","${answers}"\n`;
            });
            
            // åˆ›å»ºå¹¶ä¸‹è½½CSVæ–‡ä»¶
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `survey_data_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>
</body>
</html>
